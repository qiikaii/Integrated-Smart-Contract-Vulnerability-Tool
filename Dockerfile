FROM luongnguyen/oyente

FROM trailofbits/manticore

FROM ubuntu:18.04

WORKDIR /test


RUN echo "nameserver 8.8.8.8" | tee /etc/resolv.conf > /dev/null
RUN apt-get update
RUN apt-get install -y software-properties-common
RUN add-apt-repository ppa:deadsnakes/ppa

### Installing Python3 Environment and utilties###
RUN apt-get install -y python3.7
RUN apt-get install -y python3-pip
RUN pip3 install --upgrade pip
RUN apt-get install -y curl

### Installing Docker Components ###
RUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
RUN add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"
RUN apt-cache policy docker-ce
RUN apt-get install -y docker-ce
RUN apt-get install -y docker-ce-cli 
RUN apt-get install -y containerd.io


### Installing Git ###
RUN apt-get install -y git


### Installing wget gdebi ###
RUN apt-get install -y wget\
        gdebi


### Installing Nodejs Npm ###
RUN curl -sL https://deb.nodesource.com/setup_16.x -o nodesource_setup.sh
RUN bash nodesource_setup.sh
RUN apt-get install -y nodejs
RUN apt-get install -y build-essential
RUN nodejs -v
RUN npm install npm-upgrade
RUN npm -v


### Installing Truffle and Ganache ###
RUN npm install -g ganache-cli truffle
RUN npm audit fix


### Installing SOLC ###
RUN add-apt-repository ppa:ethereum/ethereum
RUN apt-get update
RUN apt-get install -y solc
RUN solc --version
RUN pip3 install solc-select


### Install solc-select ###
RUN ls
RUN pip3 install solc_select
COPY solidity_versions.txt solidity_versions.txt
COPY solc_install_versions.sh solc_install_versions.sh
RUN ./solc_install_versions.sh


### Slither Installation ###
RUN pip3 install slither-analyzer


### Manticore Installation ###
RUN pip3 install manticore


### Mythril Installation ###
RUN pip3 install mythril


### Securify Installation ###
WORKDIR /test
RUN git clone https://github.com/eth-sri/securify2

WORKDIR /test/securify2
RUN wget https://github.com/souffle-lang/souffle/releases/download/1.6.2/souffle_1.6.2-1_amd64.deb -O /tmp/souffle.deb &&\
        gdebi --n /tmp/souffle.deb
RUN apt-get -y install graphviz
ENV LD_LIBRARY_PATH /test/securify2/securify/staticanalysis/libfunctors

RUN python3.7 -m pip install --upgrade pip
RUN python3.7 -m pip install -r requirements.txt
RUN python3.7 -m pip install -e .
RUN solc-select use 0.5.12
RUN securify /test/securify2/securify/staticanalysis/testContract.sol


WORKDIR /test
### Expose port:5000 for flask usage ###
EXPOSE 5000
EXPOSE 8545


### Setting Flask Environment Settings ###
ENV FLASK_APP=app.py
ENV FLASK_RUN_HOST=0.0.0.0


### Copying files over to docker container ###
COPY requirements.txt requirements.txt


### Installing dependencies ###
RUN pip3 install -r requirements.txt

RUN python3 --version
WORKDIR /test/Webapp
ENV FLASK_APP=app.py
ENV LANG='C.UTF-8' LC_ALL='C.UTF-8'
ENTRYPOINT [ "/bin/bash" ]
##ENTRYPOINT [ "python3", "Webapp/app.py" ]

##CMD [ "flask", "run", "--host=0.0.0.0"]
